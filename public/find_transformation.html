<html>
<head>
  <style>
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .container {
      position: relative;
      display: inline-block;
    }

    form {
      display: inline-block;
      vertical-align: top;
      width: 40%;
    }

    label, input {
      display: inline-block;
      font-size: 2em;
      width: 30%;
    }
    label {
      width: 15%;
      padding: 10px .5em 0 1em;
    }
  </style>
  <body>
    <div class="container">
      <img src="map-dotted.png" width="1410" height="1452"/>
      <canvas id="c"></canvas>
    </div>
    <form>
      <label for="X_SLOPE">x slope:</label>
      <input id='X_SLOPE'/>
      <label for="Y_SLOPE">y slope:</label>
      <input id='Y_SLOPE'/>
      <br />
      <label for="X_INTERCEPT">x intercept:</label>
      <input id='X_INTERCEPT'/>
      <label for="Y_INTERCEPT">y intercept:</label>
      <input id='Y_INTERCEPT'/>
      <br />
      <label for="X_SCALE">x scale:</label>
      <input id='X_SCALE'/>
      <label for="Y_SCALE">y scale:</label>
      <input id='Y_SCALE'/>
   </form>
  </body>
  <script>


let image = document.querySelector('img');
let canvas = document.getElementById('c');
let cw = canvas.width = image.offsetWidth;
let ch = canvas.height = image.offsetHeight;
let ctx = canvas.getContext('2d');

ctx.strokeStyle = '#f00';
ctx.strokeRect(0,0,cw, ch);

function xCoord(x) { return (props.X_SLOPE*x + props.X_INTERCEPT) * props.X_SCALE; }
function yCoord(y) { return (props.Y_SLOPE*y + props.Y_INTERCEPT) * props.Y_SCALE; }

function map(a,b,c,d,x) {
  return c + (x-a) * (d-c) / (b - a);
}

function distance(x1,y1,x2,y2) {
  let dx = x1-x2, dy = y1-y2;
  return Math.sqrt(dx*dx + dy*dy);
}

function circle(x,y,r) {
  ctx.beginPath();
  ctx.arc(x,y,r,0,Math.PI*2,0)
}


let props = {
  X_SLOPE: 29775.8,
  X_INTERCEPT: 2540721,
  Y_SLOPE: -36341.1,
  Y_INTERCEPT: 1274255,
  X_SCALE: cw / 1410,
  Y_SCALE: ch / 1452
};

['X','Y'].forEach((dim) => {
  ['SLOPE','INTERCEPT','SCALE'].forEach((prop) => {
    let key = `${dim}_${prop}`;
    let input = document.querySelector(`#${key}`)
    input.value = props[key]
    input.addEventListener('keyup', () => {
      console.log('change')
      props[key] = parseFloat(input.value); render()
    })
  })
})

var points = [
  -85.31077518613064,35.0535224266203,0,-85.31067811491869,35.04967079532063,0,-85.31044922763955,35.04578104769464,0,-85.30941648097971,35.04583555606906,0,-85.30944096164011,35.04574181773353,0,-85.30934381538175,35.04324936954482,0,-85.30788009214638,35.04016434040857,0,-85.30753447789586,35.03951393267946,0,-85.30747762358082,35.03857895138561,0,-85.30733040512625,35.03616131748285,0,-85.30824428275594,35.03441416666769,0,-85.30881798104943,35.03147139807982,0,-85.31293911873502,35.03319019563032,0,-85.31607331772418,35.03438314009858,0,-85.31686616434069,35.03493190506184,0,-85.31740821542559,35.03561131734524,0,-85.31775554655607,35.03603806510377,0,-85.31913191618963,35.03678270139636,0,-85.32020193305688,35.03724912473964,0,-85.32078199672087,35.03773591975926,0,-85.3210135154024,35.03835307797673,0,-85.32090426847292,35.03893168542875,0,-85.31959615066043,35.04153830206791,0,-85.31972017683778,35.04239634377184,0,-85.32040482431327,35.04307835755787,0,-85.32160068521078,35.04426934267879,0,-85.32203232739096,35.04520335400382,0,-85.32232155527622,35.04659738879997,0,-85.32217743914643,35.04792722099596,0,-85.32156781522211,35.04899089762963,0,-85.32090225649097,35.05045272217,0,-85.32028180678876,35.05187547906288,0,-85.32004722504222,35.05358648039552,0,-85.31926362258808,35.0543590868383,0,-85.31737869131879,35.05480821240055,0,-85.31672055978265,35.05502305584617,0,-85.31595627462086,35.0555749173456,0,-85.3121224880625,35.05608156651083,0,-85.31073631430642,35.05662960544607,0,-85.30902068735678,35.0566457142934,0,-85.30813120044934,35.05642942191264,0,-85.3071733756308,35.05581439456255,0,-85.30644895145957,35.05484908782015,0,-85.30106054361565,35.05229394816721,0,-85.3008856033881,35.05252515440472,0,-85.30374284326315,35.05358513539338,0,-85.30381496071176,35.05379453563218,0,-85.30185422272294,35.06046629606401,0,-85.29860693180373,35.06318870432361,0,-85.30175345448748,35.06089327228771,0,-85.30154282674872,35.06112666012289,0,-85.30347210007535,35.06114232278054,0,-85.30486935760645,35.06177263356437,0,-85.30676934423222,35.06228364157094,0,-85.30702951279181,35.06012293939273,0,-85.30728810930921,35.05813182705751,0,-85.30753041850267,35.05652082183747,0,-85.30769508166536,35.05604239747375,0,-85.30754130355773,35.05355131467063,0,-85.3054938990236,35.05355103209472,0,-85.30426840020611,35.05310453175881,0,-85.29934926327526,35.05128434581584,0,-85.29978283887044,35.05064809794368,0,-85.30003382800038,35.04989770049372,0,-85.29992562496628,35.04952531048017,0,-85.29960430392158,35.04918315530006,0,-85.29799904869022,35.04856307011989,0,-85.29395158331371,35.04703620948192,0,-85.29423263309428,35.04664828615509,0,-85.29156982785507,35.04568511539248,0,

  -85.29208114052267,35.04485829654129,1,-85.29469617177335,35.04581857252639,1,-85.29785400120905,35.04702462521823,1,-85.30041398282111,35.04801802848719,0,-85.30437420398437,35.04949426049729,0,-85.30546042629733,35.0475856435762,0,-85.30564347856343,35.0474474955122,0,-85.30692403100024,35.04522308784804,0,-85.30411611029407,35.04420559058531,0,-85.30166105960778,35.04328853205798,0,-85.2974851892408,35.0417993541292,0,-85.29329948427186,35.0402185267171,0,-85.28930522258081,35.03882643804381,0,-85.28830732134286,35.03850485112213,1,-85.2844832212494,35.03655319144322,1,-85.28439065953582,35.03609776368167,1,-85.28428476227634,35.03644319115062,1,-85.28579987975775,35.0334815550763,0,-85.28649900872951,35.03229031905114,0,-85.28734369869288,35.03048299547766,0,-85.28814756716164,35.02898639086429,0,-85.29156481995031,35.03021546492595,0,-85.29444003196743,35.03129438221191,0,-85.29633242068802,35.03202221038887,0,-85.29867830060327,35.03284645839037,0,-85.30108268931427,35.03375789638773,0,-85.30255720012458,35.03433006451889,1,-85.30531952455711,35.03535395565894,0,-85.30746476642733,35.0361732420099,1,-85.31340175176477,35.03841489178473,0,-85.31213498743887,35.0406274975052,0,-85.31405130370689,35.04134866261062,0,-85.31528824641182,35.03912978982874,1,

  -85.31989387753129,35.0409008892014,0,-85.3203749858075,35.04008347200961,0,-85.32106215607656,35.03885206882585,0,-85.32109914122043,35.03824097116048,0,-85.32098414869142,35.0377820076988,0,-85.32170901654769,35.03770988738586,0,-85.32385623736343,35.03850815881657,0,-85.3252243031467,35.03902093275428,0,-85.32599944045664,35.03940951160642,0,-85.32588391225856,35.0387341660149,0,-85.32573022007534,35.03753886927294,0,-85.32522423431811,35.03664406195362,0,-85.32516882336266,35.03590294184961,0,-85.32481158481296,35.03464587648702,0,-85.32443592502445,35.03386406316023,0,-85.32394454795876,35.03260982103285,0,-85.32378304542318,35.03212584446114,0,-85.32326539183819,35.03106734082484,0,-85.32319410274584,35.03047134753503,1,-85.32303836904744,35.03018632565083,1,-85.32292031465698,35.03046110540558,0,-85.32273684221435,35.03110506231766,0,-85.32224220335532,35.03154993537169,0,-85.32177601706407,35.03192996597993,0,-85.32142421428776,35.03207206589286,0,-85.32104813395129,35.03195565304763,0,-85.32042127305672,35.03038765391011,0,-85.32028594281589,35.02970100784196,0,-85.32000108481222,35.02838187346931,0,-85.31998190221806,35.02761417878559,0,-85.32039271132099,35.02700587688064,0,-85.32060467148092,35.02664444665231,0,-85.32043773404334,35.02682367035469,0,-85.3199145912745,35.02773562087326,0,-85.32021285714085,35.02957157503531,0,-85.32045468849587,35.03067458538469,0,-85.32119180659943,35.0320257274271,0,-85.32168077645898,35.03206750617288,0,-85.32262170344946,35.03132483489357,0,-85.32300244265953,35.03008192364322,0,-85.32322945300841,35.03075442707468,0,-85.32413963806475,35.03306652075501,0,-85.32467155059925,35.03437865914177,0,-85.32517122875181,35.03549993953609,0,-85.32515563013416,35.03636386854146,0,-85.32539074105327,35.03705200495214,0,-85.32586108519433,35.03832458853493,0,-85.32612154577049,35.03986957055169,0,-85.32638460248695,35.04122945721856,0,-85.32637492433008,35.04162544032352,0,-85.32668384022804,35.04230766783758,0,-85.32674203960511,35.04255718051408,0,-85.32670997112329,35.04362247966205,0,-85.32655572808055,35.04446251928799,0,-85.32634678173565,35.04550269215218,0,-85.32599013762761,35.04685865077117,0,-85.3256118880782,35.04754389722672,0,-85.32537046786962,35.04825065452179,0,-85.3252584441986,35.04883891905079,0,-85.32519249155355,35.04925072608935,0,-85.32491505452097,35.04981275288117,0,-85.32472404489714,35.05017086246819,0,-85.32433406595072,35.05064917199364,0,-85.3242695448635,35.05092459422762,0,-85.32423800612274,35.0512491789549,0,-85.32390592309126,35.05163450928357,0,-85.3232460543492,35.05223718790061,0,-85.3231100628509,35.05240338897234,0,-85.32279946657914,35.05260034828246,0,-85.32264063449448,35.05289024196383,0,-85.32241134294227,35.0530803529423,0,-85.32178454043795,35.05367073979215,0,-85.3211789828156,35.05403425948075,0,-85.32027398896213,35.05453235028186,0,-85.31977446974133,35.05471378103379,0,-85.3192031453203,35.05489824551295,0,-85.31880026520548,35.05495160377345,0,-85.31873990425021,35.05480409575359,0,-85.31858468689514,35.054628978998,0,-85.31787423109232,35.05472824341165,0,-85.31704733937859,35.05495895399275,0,-85.31644426665133,35.05532854591706,0,-85.31612637869407,35.05546027959178,0,-85.31398507664848,35.05587744777193,0,-85.31239176763822,35.05611446797683,0,-85.30991651912403,35.05671627639723,0,-85.30926372287011,35.05664099129377,0,-85.30829668428478,35.05651488548839,0,-85.30790169715681,35.05631734099497,0,-85.30692189859337,35.05546998197848,0,-85.30657577954595,35.05481514843733,0,-85.30607492016857,35.05431134339409,0,-85.30435134198316,35.05353188335356,0,-85.30135393030017,35.05241532913906,0,-85.30089489435474,35.05225125187772,0,-85.3009652001596,35.0525905954263,0,-85.30287565983052,35.05318031103076,0,-85.30357017074485,35.05350378513754,0,-85.30380720791901,35.0536883852452,0,-85.30353664522771,35.05408932981371,0,-85.3032756473125,35.05454140527583,0,-85.30273651509378,35.05632757342367,0,-85.30214352923112,35.05879802060454,0,-85.3016620429611,35.06041476514278,0,-85.30115894578185,35.06123421764894,0,-85.29976347982729,35.06238884405008,0,-85.29875111975407,35.06302718990536,0,-85.30036210050679,35.06194413149574,0,-85.30130206672811,35.06115359198081,0,-85.3018096578254,35.06108288998055,0,-85.30352989869201,35.06121811348346,0,-85.30477861499945,35.06175819842429,0,-85.30625990341483,35.0622215937026,0,-85.30662016787798,35.06238160162506,0,-85.30690968030758,35.06116247129953,0,-85.30699327524525,35.06037417589702,0,-85.30728094544963,35.05840094981633,0,-85.30744425932316,35.05727599303751,0,-85.30752830644992,35.05662345554256,0,-85.30761250385339,35.05626378427554,0,-85.30763777021657,35.05573116264607,0,-85.30757364606433,35.05361590891292,0,-85.30636610693944,35.05362741994777,0,-85.30583422055116,35.0536014804372,0,-85.30484447157926,35.0533652020906,0,-85.30387559155213,35.05292495697905,0,-85.30305917894404,35.05269731010801,0,-85.30115625112572,35.05190296073709,0,-85.29985613370903,35.05148813491432,0,-85.29943598060905,35.05138596307719,0,-85.29968206325422,35.05081884191926,0,-85.30005562638378,35.0500176836334,0,-85.30015756632092,35.04965050735582,0,-85.29976524036795,35.04933698749043,0,-85.29860821969825,35.04881102707596,0,-85.29757718814918,35.04841560078782,0,-85.29567854937265,35.04771193704154,0,-85.29395611937179,35.04710009597991,0,-85.29414307744584,35.0466234390977,0,-85.29147591126015,35.04567325442421,0,

-85.29208114052267,35.04485829654129,1,-85.29469617177335,35.04581857252639,1,-85.29785400120905,35.04702462521823,1,-85.30041398282111,35.04801802848719,0,-85.30437420398437,35.04949426049729,0,-85.30546042629733,35.0475856435762,0,-85.30564347856343,35.0474474955122,0,-85.30692403100024,35.04522308784804,0,-85.30411611029407,35.04420559058531,0,-85.30166105960778,35.04328853205798,0,-85.2974851892408,35.0417993541292,0,-85.29329948427186,35.0402185267171,0,-85.28930522258081,35.03882643804381,0,-85.28830732134286,35.03850485112213,1,-85.2844832212494,35.03655319144322,1,-85.28439065953582,35.03609776368167,1,-85.28428476227634,35.03644319115062,1,-85.28579987975775,35.0334815550763,0,-85.28649900872951,35.03229031905114,0,-85.28734369869288,35.03048299547766,0,-85.28814756716164,35.02898639086429,0,-85.29156481995031,35.03021546492595,0,-85.29444003196743,35.03129438221191,0,-85.29633242068802,35.03202221038887,0,-85.29867830060327,35.03284645839037,0,-85.30108268931427,35.03375789638773,0,-85.30255720012458,35.03433006451889,1,-85.30531952455711,35.03535395565894,0,-85.30746476642733,35.0361732420099,1,-85.31340175176477,35.03841489178473,0,-85.31213498743887,35.0406274975052,0,-85.31405130370689,35.04134866261062,0,-85.31528824641182,35.03912978982874,0,-85.31672399824535,35.03651972973277,0
]

let totalDistance = 0;
for (var i=0; i<points.length-3; i+=3)
  totalDistance += distance(points[i], points[i+1], points[i+3], points[i+4]);
let currentIndex = 0;
let segmentStartDistance = 0;
let segmentEndDistance = distance(points[0],points[1],points[3],points[4]);
let START_TIME = new Date().getTime();
const END_TIME = START_TIME + 60*1000;

render();

function render() {
  ctx.clearRect(0,0,cw,ch);
  let d = Math.min(map(START_TIME, END_TIME, 0, totalDistance, new Date().getTime()), totalDistance);
  while (d > segmentEndDistance && currentIndex < points.length) {
    currentIndex+=3;
    segmentStartDistance = segmentEndDistance;
    segmentEndDistance += distance(points[currentIndex],points[currentIndex+1],points[currentIndex+3], points[currentIndex+4])
  }
  let x = map(segmentStartDistance, segmentEndDistance, xCoord(points[currentIndex+0]), xCoord(points[currentIndex+3]), d);
  let y = map(segmentStartDistance, segmentEndDistance, yCoord(points[currentIndex+1]), yCoord(points[currentIndex+4]), d);
  ctx.fillStyle = '#fff'
  ctx.strokeStyle = '#000'
  ctx.lineWidth = 10;
  circle(x,y,15);
  ctx.fill();
  ctx.stroke();

  requestAnimationFrame(render);
}

// function render() {
//   ctx.clearRect(0,0,cw,ch);
//   ctx.beginPath();
//   for (var i=0; i<points.length; i+=3) {
//     var point = [points[i+1], points[i]];
//     var x = (props.X_SLOPE*point[1] + props.X_INTERCEPT) * props.X_SCALE;
//     var y = (props.Y_SLOPE*point[0] + props.Y_INTERCEPT) * props.Y_SCALE;
//     ctx.lineTo(x,y);
//     // circle(x,y,10);
//     if (points[i+2] != 0)
//       ctx.strokeStyle = '#00f';
//     else
//       ctx.strokeStyle = 'rgb('+parseInt(map(0,points.length,0,255, i))+','+parseInt(map(0,points.length,255,0, i))+',0)';
//     ctx.lineWidth = 8;
//     ctx.stroke();
//     ctx.beginPath();
//     ctx.moveTo(x,y);
//   }
// }


  </script>

</head>
